Caption2Ass_PCR.exe
＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝＝
「Caption2Ass 補完計画（Cleanup code）」を改造したものです。
ass出力の場合に字幕の位置・色・ルビ(ふりがな)を再現するようにしました。
srt出力の場合に字幕の色を再現するようにしました。

【使用許諾条件】
このソフトを使用して得られるいかなるデータを、インターネット上にアップロードしたり、
あるいはインターネット以外であっても使用者以外の人間に渡すことを前提とした使用を
一切禁じます。
使用者個人の研究目的という条件の下でのみ、当ソフトの使用が許されます。
この条件は、Caption2Ass_PCR.exeの過去のバージョンすべてに該当します。
守れない場合は、いかなる記憶装置にインストールあるいは保存した当ソフトと
得られたデータのすべてを即刻消去しなければなりません。
万一、上記の許諾条件外の使用が発覚した際には、本ソフトの公開を停止します。

【再配布】
上記の使用許諾条件の範囲内で再配布を許可します。

【ライセンス関係】
このCaption2Ass_PCR.exeは、「Caption2Ass 補完計画（Cleanup code）」および、
「台湾人のodaruさんのCaption2Ass.exe」のライセンスに従います
しかし、両方ともライセンスについて記述がありませんでした
そこで、「台湾人のodaruさんのCaption2Ass.exeに付属のReadme.txt」に
「This programming is based on the caption.dll of EDCB, Thanks.」の
記述があることから、勝手ながらcaption.dllのライセンスに準じるものと
判断させて頂きました
以下はオリジナル版Caption.dll付属のReadme.txtのライセンス関連部分です。
自ずと本改造版も以下に従います。
-------------
●EpgDataCap_Bon、TSEpgView_Sample、NetworkRemocon、Caption、TSEpgViewServerの
ソースの取り扱いについて
　特にGPLとかにはしないので自由に改変してもらって構わないです。
　改変して公開する場合は改変部分のソースぐらいは一緒に公開してください。
　（強制ではないので別に公開しなくてもいいです）
　EpgDataCap.dllの使い方の参考にしてもらうといいかも。

●EpgDataCap.dll、Caption.dllの取り扱いについて
　フリーソフトに組み込む場合は特に制限は設けません。ただし、dllはオリジナルのまま
　組み込んでください。
　このdllを使用したことによって発生した問題について保証は一切行いません。
　商用、シェアウェアなどに組み込むのは不可です。
-------------

【連絡方法】
要望や不具合の報告は、２ちゃんねるの「【開発】 TS関連ソフトウェア総合スレ」
でしてください
後、「http://plaza.rakuten.co.jp/mark10als/」や「mark10als@gmail.com」は、
ありますが基本は、２ちゃんねるでお願いします

【動作環境】
・Windows XP SP3で開発(たぶんVistaや７でも動くと思います)
・Visual C++ 2010 SP1 再頒布可能パッケージ

【使用方法】

1. Caption2Ass_PCR.exe と 「Caption.dll改造版」を同じフォルダーに置く。

2. cmd.exeを実行する。

3. Caption2Ass_PCR.exe "C:\MyRecordedTsFile.ts"
      このように Caption2Ass_PCR.exeを実行してください。
      C:\MyRecordedTsFile.tsは保存されたTSファイルの名前です。
      (Double quotation marksを忘れないで。)

   出力字幕タイプ指定可能。(-format {srt|ass|taw|dual})
   Ex: Caption2Ass_PCR.exe -format srt "C:\MyRecordedTsFile.ts"

【オプションについて】
・「-format」
     字幕ファイルのフォーマットを指定(省略時はass)
         srt : srtフォーマット、文字コードはUTF8(BOM)
         ass : assフォーマット、文字コードはUTF8(BOM)
         taw : srtフォーマット、文字コードはシフト・ジス(S-JIS)
         dual : 一回の処理でsrtとassの両方を作る。欲張りな私用の指定
・「-PMT_PID」
     PMT Pid指定もできる。PIDは Hex
・「-delay」
     字幕のタイミングを任意のミリ秒単位（整数値）で遅らせます。
     負の整数値を使ってタイミングを早めることも出来ます。
     　Ex:　-delay -300
     　300msec字幕を早めます。
・「-asstype」
     ass出力の時に事前にiniファィルで指定した、フォント名やサイズ等を
     示す「セクション名」を指定する
・「-norubi」
     ASS字幕のルビを出力抑止する
・「-detect_length」
     字幕の有無のチェックを行うパケットの数(万の単位)を指定する
     尚、数値に「0」を指定するとファイルの最後まで読む
     省略時は、300万パケット(約5分)以内に字幕が無ければ終了する
     「-detect_length 数値」オプションの数値(万の単位)で変更が出来る
     　Ex:　-detect_length 10
     　先頭から10万パケット
・「-srtornament」
     srt出力の時に色をHTML装飾で出力する
     省略した時には装飾しない
     フォーマットに「taw」を指定していれば、無視します
・「-hlc」
     ASS出力でHLCの時は、オプションで三つから選択する
         kigou : SRTと同じく[囲い文字]・・・デフォルト
         box   : ■を横に引き伸ばして表示
         draw  : draw系のコマンドで
・「-log」
     不具合が発生したら、このオプションを指定してログ・ファイルを作成します
     報告して下されば、対応できるかもしれない
・「-i」
     入力ファィルを他のオプションと同じ様に指定できる
     今までのバージョンと同じ様に「-i」無しでも使用可能
・「-o」
     入力ファィルを他のオプションと同じ様に指定できる
     今までのバージョンと同じ様に「-o」無しでも使用可能

【iniファィルについて】
・iniファィルセクションを追加して字幕スタイルを変更できます
<<<<<<--------
[SWFModeOffset]
SWF0offset=0
SWF5offset=0
SWF7offset=0
SWF9offset=0
SWF11offset=0
[Default]
Comment1="Script generated by Aegisub v2.1.2 RELEASE PREVIEW (SVN r1987, amz)"
Comment2="http://www.aegisub.net"
Comment3=
PlayResX=1920
PlayResY=1080
DefaultFontname="MS UI Gothic"
DefaultFontsize=90
DefaultStyle='&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,5,0,1,2,2,1,10,10,10,0'
RubiFontname="MS UI Gothic"
RubiFontsize=50
RubiStyle='&H00FFFFFF,&H000000FF,&H00000000,&H00000000,0,0,0,0,100,100,0,0,1,2,2,1,10,10,10,0'
<<<<<<--------
[SWFModeOffset]セクションは、字幕全体を上下させる為の設定です
ARIBの規格の標準文字でHDであれば、60を指定すると１行下になります

[Default]セクションの各項目がassのヘッダーに反映されます
参考にして、好みのフォント名やサイズを指定した
セクションを作って下さい。
ドラマやアニメでは、フォントを替えてみることも、面白いかも！？

【謝辞】
Special thanks to
・「Caption2Ass 補完計画（Cleanup code）」を公開してくれた方
・odaruさん、
・mod1の中の人さん、
・EDCBの中の人さん、
・字幕抽出ツール C-Cats の作者さん、
・makiさん、
・人柱になってデバッグにお付き合いいただいている方々
皆さんのおかげでつくれました

【Caption2Ass_PCRの変更履歴】
2012-07-21
0,3,0,4
・前回追加した「表示出来ない字幕は出力しない」でPCR巡回発生の
  対応していなかったので修正した

2012-06-04
0,3,0,3
・makiさんからの報告に依り、２点を修正した
１、SRTでのHLCの[囲い文字]を文字修飾タグの内側に出力するようにした
２、Caption.dll無でexeを実行した際のロード失敗確認の追加
・「-delay」負の整数値を指定した時に、表示出来ない字幕は出力しない

2012-05-31
0,3,0,2
・ASS出力でHLCの時は、オプションで三つから選択するようにした
１、SRTと同じく[囲い文字]・・・デフォルト
２、■を横に引き伸ばして表示
３、draw系のコマンドで
・ログの出力に文字の修飾も含めるようにした
・outCharColorの初期化されてない1バイト分のゴミの対策をした

2012-05-24
0,3,0,1
・SRT出力でHLCの時はテキストを"["と"]"で挟む

2012-05-23
0,3,0,0
＊このバージョンは、odaruさん及び、mod1の中の人さんの
．Caption.dllを使えなくなりました
・HLC,UnderLine,Bold,Italicに対応してみた
．HLC対応にあたり「Caption2Ass_PCR.ini」を修正しました
．DefaultStyleのSpacing値を「5」から「15」に変更した
．BoxFontname,BoxFontsize,BoxStyleの三つを追加

2012-04-24
0,2,0,6
・16:9→4:3の座標変換を追加した
．PlayResXとPlayResYが４対３の比率の場合に座標変換を行う
．同梱の「Caption2Ass_PCR.ini」のセクション[Default43]
．をオプション「-asstype」で指定します

2012-04-09
0,2,0,5
「【開発】 TS関連ソフトウェア総合スレ Part10」
の>>548にて字幕の表示時間周りにおける不具合を報告頂きました
そして、>>549,>>550,>>552にてmakiさんが、迅速に修正もして頂いたので、
これをver.0,2,0,5として採用させて頂きました
修正の理由と内容に付いての文書も添付されていたので、
大変お世話になりました
・補正計算が誤動作するケースへの対処 (548さんの報告内容)
  startPCR 補正要否の条件を追加して対応。
・startPCR 補正計算の誤りを修正

2012-02-13
0,2,0,4
・ASS字幕のルビを出力抑止する「-norubi」オプションを追加した
・字幕のPID判定を少し厳格に判定するようにした
・字幕の有無のチェックを行うパケットの数(万の単位)を指定する
  「-detect_length」オプションを追加した
     尚、数値に「0」を指定するとファイルの最後まで読む
     省略時は、300万パケット(約5分)以内に字幕が無ければ終了する

2012-02-08
0,2,0,3
・SRT字幕で同一のタイミングにルビしか無かった場合に、空行を出力

2012-01-27
0,2,0,2
・字幕が全く無かった場合に、出力ファイルを削除
・出力ファイルの拡張子が「.ts」の時は、入力ファイルの拡張子を替えて出力

2011-12-03
0,2,0,1
・全角１６文字を超える場合の改行処理に対応
  「Caption.dll 0201改造版」で処理している

2011-11-27
0,2,0,0
・ユニコードに対応した「Caption.dll 0200改造版」を同梱
・「Caption.dll 0200改造版」を使用していれば、「taw」以外のときに
  ユニコードで記述した設定ファイルを読込みます

2011-10-23
0,1,1,1
・前回「PCRのPID取得位置を修正した」による不具合が発生した為に
  PCRのPID取得位置を戻した。
・PMT判定を強化した

2011-10-14
0,1,1,0
・PCRのPID取得位置を修正した
・srt出力の場合に色をHTMLタグで出力出来るようにした
・ログ・ファイルの項目を増やした

2011-10-12
0,1,0,9
「【開発】 TS関連ソフトウェア総合スレ Part9」
の241にて字幕の表示時間周りにおける不具合をを確認して
修正もして頂いたので、これをver.0109として採用させて頂きました
修正の理由と内容に付いての文書も添付されていたので、
大変お世話になりました
・PCR,PTSを33ビットで処理
・字幕全体が800ミリ程度早く表示されるの修正
・PCR巡回発生後の字幕時間に100ミリ程度のズレの修正
「Caption2Ass_PCR_ver.0108を修正してみた」
ttp://2sen.dip.jp/cgi-bin/dtvup/source/up0762.zip


2011-09-22
0,1,0,8
・SD放送の字幕の位置を微調整した
・iniファィルを拡張して調整可能な項目を増やした
・ログ・ファイルの項目を増やした

2011-09-19
0,1,0,7
・SD放送の字幕の対応を改善したつもり

2011-09-18
0,1,0,6
・字幕のタイミングを修正して、CS放送に対応したつもり
   メモ
   時間の基準となるPCRパケットが映像パケットと同じPIDで
   送信されていたので、PCRパケットのチェックを強化した

2011-09-16
0,1,0,5
・SD放送の字幕に対応したつもり
・オプションに「-log」を追加した
      この変更により「Caption2Ass_PCR_D.exe」の同梱を廃止した
・mod1の中の人のCaption.dll(0.1.1.4)に対応した
      この変更により「Caption_PCR.dll」の同梱を廃止した

2011-09-12
0,1,0,4
・オプションの充実（odaruさん版やmod1さん版を参考にして）
      -format に taw と dualを追加した
      -delay を追加した
      -asstype を追加した
・フォント名やサイズ等をiniファィル化
      iniファィルにセクションを追加して、「-asstype」のオプションで
      セクションを指定すれば、好みの表示に出来る
・半角文字に対応
      HDUS関係ファイル置き場の「up0209.zip 字幕 Plugin For TVTest(20081215)」の
      「CommRoutine.cpp」と「CommRoutine.h」を移植して実現
・字幕のタイミングを修正
・字幕の位置を調整
・改造版0.1.1.1を更に改造したCaption_PCR.dllを同梱

2011-09-04
0,1,0,3
・字幕のタイミングを修正
・字幕の位置を調整
・改造版0.1.1.1を更に改造したCaption_PCR.dllを同梱

2011-08-27
0,1,0,2
・Caption2Ass_PCR.exeとして公開
・改造版0.1.1.1を更に改造したCaption.dllを同梱
・字幕の色が白色の時には色の指定を省略した

2011-08-25
0,1,0,1
・Caption2Ass_PC.exeとして公開
・字幕の位置・色・ルビ(ふりがな)に対応

2011-08-XX
0,1,0,0
・「Caption2Ass 補完計画（Cleanup code）」をVC++2010でビルドしただけ。
  ここが、出発点。
